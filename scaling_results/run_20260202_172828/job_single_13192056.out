============================================================
Scaling Test Worker (Fixed)
============================================================
Job ID:         13192056
Nodes:          1
Mode:           single
Config:         /p/project1/cameo/schmidt36/chemtrain-deploy/external/chemtrain/clean_code_base/scripts/config_scaling_test.yaml
Output dir:     /p/project1/cameo/schmidt36/chemtrain-deploy/external/chemtrain/clean_code_base/scaling_results/run_20260202_172828
============================================================

============================================================
Single-node scaling tests (1-4 devices)
============================================================

------------------------------------------------------------
Testing with 1 device(s)...
------------------------------------------------------------
  CUDA_VISIBLE_DEVICES=0
  Running training...
[Model] Using Allegro size: default
[Model] Detected 18 unique species
[Model] Using Allegro config size: default
[Model] Mode: Prior + Allegro
[Model] Prior weights: {'bond': 0.5, 'angle': 0.25, 'dihedral': 0.25, 'repulsive': 1.0}
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/ops/scatter.py:92: FutureWarning: scatter inputs have incompatible types: cannot safely cast value from dtype=float32 to dtype=int32 with jax_numpy_dtype_promotion='standard'. In future JAX releases this will result in an error.
  warnings.warn(
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/ops/scatter.py:92: FutureWarning: scatter inputs have incompatible types: cannot safely cast value from dtype=float32 to dtype=int32 with jax_numpy_dtype_promotion='standard'. In future JAX releases this will result in an error.
  warnings.warn(
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/ops/scatter.py:92: FutureWarning: scatter inputs have incompatible types: cannot safely cast value from dtype=float32 to dtype=int32 with jax_numpy_dtype_promotion='standard'. In future JAX releases this will result in an error.
  warnings.warn(
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/numpy/lax_numpy.py:183: UserWarning: Explicitly requested dtype float64 requested in asarray is not available, and will be truncated to dtype float32. To enable more dtypes, set the jax_enable_x64 configuration option or the JAX_ENABLE_X64 shell environment variable. See https://github.com/jax-ml/jax#current-gotchas for more.
  return asarray(x, dtype=self.dtype)
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/numpy/reductions.py:213: UserWarning: Explicitly requested dtype <class 'jax.numpy.float64'> requested in sum is not available, and will be truncated to dtype float32. To enable more dtypes, set the jax_enable_x64 configuration option or the JAX_ENABLE_X64 shell environment variable. See https://github.com/jax-ml/jax#current-gotchas for more.
  return _reduction(a, "sum", np.sum, lax.add, 0, preproc=_cast_to_numeric,
[Training] Initialized model with seed=193749
[Training] Applied NumpyDataLoader patch
[Training] 
============================================================
[Training] Training Stage: ADABELIEF (3 epochs, starting from 0)
[Training] ============================================================
/p/project1/cameo/schmidt36/chemtrain-deploy/external/chemtrain/chemtrain/trainers/base.py:957: UserWarning: Batch size 16 does not divide the number of observations 2250. Trainer will skip 10 samples for state training
  warnings.warn(
/p/project1/cameo/schmidt36/chemtrain-deploy/external/chemtrain/chemtrain/trainers/base.py:957: UserWarning: Batch size 16 does not divide the number of observations 250. Trainer will skip 10 samples for state validation
  warnings.warn(
[Scaling] Single-node mode: 1 device(s)
[Scaling] CUDA_VISIBLE_DEVICES = 0
[Rank 0] Local devices: [CudaDevice(id=0)]
============================================================
SCALING TEST (FIXED)
============================================================
Expected devices: 1
Actual devices:   1
Distributed:      False
Rank:             0/1
Local devices:    1
============================================================
Capping edges and triplets. Beware of overflow, which is currently not being detected.
Estimated max. 900 edges.
[Allegro] Use two atom species for oxygen and hydroge.
[Allegro] Use default mask
Use a custom scatter implementation
Out irreps 300x0e+556x1o+256x1e+556x2e+384x2o+512x3o+256x3e
Irreps after layer are 128x1o+128x1e+128x2e+128x2o+128x3o+128x3e
Use a custom scatter implementation
Out irreps 256x0e+768x1o+896x2e
Irreps after layer are 128x1o+128x2e
Use a custom scatter implementation
Out irreps 256x0e
Irreps after layer are Irreps()

============================================================
TRAINING WITH TIMING
============================================================
[Allegro] Use two atom species for oxygen and hydroge.
[Allegro] Use default mask
Use a custom scatter implementation
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/ops/scatter.py:92: FutureWarning: scatter inputs have incompatible types: cannot safely cast value from dtype=float32 to dtype=int32 with jax_numpy_dtype_promotion='standard'. In future JAX releases this will result in an error.
  warnings.warn(
Out irreps 300x0e+556x1o+256x1e+556x2e+384x2o+512x3o+256x3e
Irreps after layer are 128x1o+128x1e+128x2e+128x2o+128x3o+128x3e
Use a custom scatter implementation
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/ops/scatter.py:92: FutureWarning: scatter inputs have incompatible types: cannot safely cast value from dtype=float32 to dtype=int32 with jax_numpy_dtype_promotion='standard'. In future JAX releases this will result in an error.
  warnings.warn(
Out irreps 256x0e+768x1o+896x2e
Irreps after layer are 128x1o+128x2e
Use a custom scatter implementation
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/ops/scatter.py:92: FutureWarning: scatter inputs have incompatible types: cannot safely cast value from dtype=float32 to dtype=int32 with jax_numpy_dtype_promotion='standard'. In future JAX releases this will result in an error.
  warnings.warn(
Out irreps 256x0e
Irreps after layer are Irreps()
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/numpy/lax_numpy.py:183: UserWarning: Explicitly requested dtype float64 requested in asarray is not available, and will be truncated to dtype float32. To enable more dtypes, set the jax_enable_x64 configuration option or the JAX_ENABLE_X64 shell environment variable. See https://github.com/jax-ml/jax#current-gotchas for more.
  return asarray(x, dtype=self.dtype)
[Force] Found precomputed forces.
[Force] Found precomputed forces.
[Epoch 0]:
	Average train loss: 102.02159
	Average val loss: 86.51534271240234
	Gradient norm: 8.774136543273926
	Elapsed time = 5.135 min
	Per-target losses:
		F | train loss: 102.02158960614885 | val loss: 86.51534271240234

[Epoch 1]:
	Average train loss: 84.68770
	Average val loss: 86.49392700195312
	Gradient norm: 5.8762078285217285
	Elapsed time = 4.208 min
	Per-target losses:
		F | train loss: 84.68770261492048 | val loss: 86.49392700195312

[Epoch 2]:
	Average train loss: 84.08924
	Average val loss: 85.68284606933594
	Gradient norm: 6.125792503356934
	Elapsed time = 4.208 min
	Per-target losses:
		F | train loss: 84.08923628670829 | val loss: 85.68284606933594

[Training] 
Stage complete: train_loss=84.089236, val_loss=85.682846

Total training time: 900.27s
Timing data saved to: /p/project1/cameo/schmidt36/chemtrain-deploy/external/chemtrain/clean_code_base/scaling_results/run_20260202_172828/timing_1dev_13192056_1dev.json

============================================================
SCALING TEST COMPLETE
============================================================
  Total time: 934.628075170s
  Throughput: 7.22 samples/s

------------------------------------------------------------
Testing with 2 device(s)...
------------------------------------------------------------
  CUDA_VISIBLE_DEVICES=0,1
  Running training...
[Model] Using Allegro size: default
[Model] Detected 18 unique species
[Model] Using Allegro config size: default
[Model] Mode: Prior + Allegro
[Model] Prior weights: {'bond': 0.5, 'angle': 0.25, 'dihedral': 0.25, 'repulsive': 1.0}
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/ops/scatter.py:92: FutureWarning: scatter inputs have incompatible types: cannot safely cast value from dtype=float32 to dtype=int32 with jax_numpy_dtype_promotion='standard'. In future JAX releases this will result in an error.
  warnings.warn(
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/ops/scatter.py:92: FutureWarning: scatter inputs have incompatible types: cannot safely cast value from dtype=float32 to dtype=int32 with jax_numpy_dtype_promotion='standard'. In future JAX releases this will result in an error.
  warnings.warn(
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/ops/scatter.py:92: FutureWarning: scatter inputs have incompatible types: cannot safely cast value from dtype=float32 to dtype=int32 with jax_numpy_dtype_promotion='standard'. In future JAX releases this will result in an error.
  warnings.warn(
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/numpy/lax_numpy.py:183: UserWarning: Explicitly requested dtype float64 requested in asarray is not available, and will be truncated to dtype float32. To enable more dtypes, set the jax_enable_x64 configuration option or the JAX_ENABLE_X64 shell environment variable. See https://github.com/jax-ml/jax#current-gotchas for more.
  return asarray(x, dtype=self.dtype)
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/numpy/reductions.py:213: UserWarning: Explicitly requested dtype <class 'jax.numpy.float64'> requested in sum is not available, and will be truncated to dtype float32. To enable more dtypes, set the jax_enable_x64 configuration option or the JAX_ENABLE_X64 shell environment variable. See https://github.com/jax-ml/jax#current-gotchas for more.
  return _reduction(a, "sum", np.sum, lax.add, 0, preproc=_cast_to_numeric,
[Training] Initialized model with seed=193749
[Training] Applied NumpyDataLoader patch
[Training] 
============================================================
[Training] Training Stage: ADABELIEF (3 epochs, starting from 0)
[Training] ============================================================
/p/project1/cameo/schmidt36/chemtrain-deploy/external/chemtrain/chemtrain/trainers/base.py:957: UserWarning: Batch size 32 does not divide the number of observations 2250. Trainer will skip 10 samples for state training
  warnings.warn(
/p/project1/cameo/schmidt36/chemtrain-deploy/external/chemtrain/chemtrain/trainers/base.py:957: UserWarning: Batch size 32 does not divide the number of observations 250. Trainer will skip 26 samples for state validation
  warnings.warn(
[Scaling] Single-node mode: 2 device(s)
[Scaling] CUDA_VISIBLE_DEVICES = 0,1
[Rank 0] Local devices: [CudaDevice(id=0), CudaDevice(id=1)]
============================================================
SCALING TEST (FIXED)
============================================================
Expected devices: 2
Actual devices:   2
Distributed:      False
Rank:             0/1
Local devices:    2
============================================================
Capping edges and triplets. Beware of overflow, which is currently not being detected.
Estimated max. 900 edges.
[Allegro] Use two atom species for oxygen and hydroge.
[Allegro] Use default mask
Use a custom scatter implementation
Out irreps 300x0e+556x1o+256x1e+556x2e+384x2o+512x3o+256x3e
Irreps after layer are 128x1o+128x1e+128x2e+128x2o+128x3o+128x3e
Use a custom scatter implementation
Out irreps 256x0e+768x1o+896x2e
Irreps after layer are 128x1o+128x2e
Use a custom scatter implementation
Out irreps 256x0e
Irreps after layer are Irreps()

============================================================
TRAINING WITH TIMING
============================================================
[Allegro] Use two atom species for oxygen and hydroge.
[Allegro] Use default mask
Use a custom scatter implementation
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/ops/scatter.py:92: FutureWarning: scatter inputs have incompatible types: cannot safely cast value from dtype=float32 to dtype=int32 with jax_numpy_dtype_promotion='standard'. In future JAX releases this will result in an error.
  warnings.warn(
Out irreps 300x0e+556x1o+256x1e+556x2e+384x2o+512x3o+256x3e
Irreps after layer are 128x1o+128x1e+128x2e+128x2o+128x3o+128x3e
Use a custom scatter implementation
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/ops/scatter.py:92: FutureWarning: scatter inputs have incompatible types: cannot safely cast value from dtype=float32 to dtype=int32 with jax_numpy_dtype_promotion='standard'. In future JAX releases this will result in an error.
  warnings.warn(
Out irreps 256x0e+768x1o+896x2e
Irreps after layer are 128x1o+128x2e
Use a custom scatter implementation
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/ops/scatter.py:92: FutureWarning: scatter inputs have incompatible types: cannot safely cast value from dtype=float32 to dtype=int32 with jax_numpy_dtype_promotion='standard'. In future JAX releases this will result in an error.
  warnings.warn(
Out irreps 256x0e
Irreps after layer are Irreps()
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/numpy/lax_numpy.py:183: UserWarning: Explicitly requested dtype float64 requested in asarray is not available, and will be truncated to dtype float32. To enable more dtypes, set the jax_enable_x64 configuration option or the JAX_ENABLE_X64 shell environment variable. See https://github.com/jax-ml/jax#current-gotchas for more.
  return asarray(x, dtype=self.dtype)
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/numpy/reductions.py:213: UserWarning: Explicitly requested dtype <class 'jax.numpy.float64'> requested in sum is not available, and will be truncated to dtype float32. To enable more dtypes, set the jax_enable_x64 configuration option or the JAX_ENABLE_X64 shell environment variable. See https://github.com/jax-ml/jax#current-gotchas for more.
  return _reduction(a, "sum", np.sum, lax.add, 0, preproc=_cast_to_numeric,
[Force] Found precomputed forces.
[Force] Found precomputed forces.
[Epoch 0]:
	Average train loss: 116.22558
	Average val loss: 86.80593872070312
	Gradient norm: 6.714452743530273
	Elapsed time = 3.126 min
	Per-target losses:
		F | train loss: 116.22558081490654 | val loss: 86.80593872070312

[Epoch 1]:
	Average train loss: 84.97892
	Average val loss: 86.28740692138672
	Gradient norm: 6.664463043212891
	Elapsed time = 2.061 min
	Per-target losses:
		F | train loss: 84.97891595023019 | val loss: 86.28740692138672

[Epoch 2]:
	Average train loss: 84.33376
	Average val loss: 86.15654754638672
	Gradient norm: 7.481634616851807
	Elapsed time = 2.061 min
	Per-target losses:
		F | train loss: 84.33376410348075 | val loss: 86.15654754638672

[Training] 
Stage complete: train_loss=84.333764, val_loss=86.156548

Total training time: 487.26s
Timing data saved to: /p/project1/cameo/schmidt36/chemtrain-deploy/external/chemtrain/clean_code_base/scaling_results/run_20260202_172828/timing_2dev_13192056_2dev.json

============================================================
SCALING TEST COMPLETE
============================================================
  Total time: 519.154113814s
  Throughput: 13.00 samples/s

------------------------------------------------------------
Testing with 3 device(s)...
------------------------------------------------------------
  CUDA_VISIBLE_DEVICES=0,1,2
  Running training...
[Model] Using Allegro size: default
[Model] Detected 18 unique species
[Model] Using Allegro config size: default
[Model] Mode: Prior + Allegro
[Model] Prior weights: {'bond': 0.5, 'angle': 0.25, 'dihedral': 0.25, 'repulsive': 1.0}
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/ops/scatter.py:92: FutureWarning: scatter inputs have incompatible types: cannot safely cast value from dtype=float32 to dtype=int32 with jax_numpy_dtype_promotion='standard'. In future JAX releases this will result in an error.
  warnings.warn(
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/ops/scatter.py:92: FutureWarning: scatter inputs have incompatible types: cannot safely cast value from dtype=float32 to dtype=int32 with jax_numpy_dtype_promotion='standard'. In future JAX releases this will result in an error.
  warnings.warn(
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/ops/scatter.py:92: FutureWarning: scatter inputs have incompatible types: cannot safely cast value from dtype=float32 to dtype=int32 with jax_numpy_dtype_promotion='standard'. In future JAX releases this will result in an error.
  warnings.warn(
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/numpy/lax_numpy.py:183: UserWarning: Explicitly requested dtype float64 requested in asarray is not available, and will be truncated to dtype float32. To enable more dtypes, set the jax_enable_x64 configuration option or the JAX_ENABLE_X64 shell environment variable. See https://github.com/jax-ml/jax#current-gotchas for more.
  return asarray(x, dtype=self.dtype)
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/numpy/reductions.py:213: UserWarning: Explicitly requested dtype <class 'jax.numpy.float64'> requested in sum is not available, and will be truncated to dtype float32. To enable more dtypes, set the jax_enable_x64 configuration option or the JAX_ENABLE_X64 shell environment variable. See https://github.com/jax-ml/jax#current-gotchas for more.
  return _reduction(a, "sum", np.sum, lax.add, 0, preproc=_cast_to_numeric,
[Training] Initialized model with seed=193749
[Training] Applied NumpyDataLoader patch
[Training] 
============================================================
[Training] Training Stage: ADABELIEF (3 epochs, starting from 0)
[Training] ============================================================
/p/project1/cameo/schmidt36/chemtrain-deploy/external/chemtrain/chemtrain/trainers/base.py:957: UserWarning: Batch size 48 does not divide the number of observations 2250. Trainer will skip 42 samples for state training
  warnings.warn(
/p/project1/cameo/schmidt36/chemtrain-deploy/external/chemtrain/chemtrain/trainers/base.py:957: UserWarning: Batch size 48 does not divide the number of observations 250. Trainer will skip 10 samples for state validation
  warnings.warn(
[Scaling] Single-node mode: 3 device(s)
[Scaling] CUDA_VISIBLE_DEVICES = 0,1,2
[Rank 0] Local devices: [CudaDevice(id=0), CudaDevice(id=1), CudaDevice(id=2)]
============================================================
SCALING TEST (FIXED)
============================================================
Expected devices: 3
Actual devices:   3
Distributed:      False
Rank:             0/1
Local devices:    3
============================================================
Capping edges and triplets. Beware of overflow, which is currently not being detected.
Estimated max. 900 edges.
[Allegro] Use two atom species for oxygen and hydroge.
[Allegro] Use default mask
Use a custom scatter implementation
Out irreps 300x0e+556x1o+256x1e+556x2e+384x2o+512x3o+256x3e
Irreps after layer are 128x1o+128x1e+128x2e+128x2o+128x3o+128x3e
Use a custom scatter implementation
Out irreps 256x0e+768x1o+896x2e
Irreps after layer are 128x1o+128x2e
Use a custom scatter implementation
Out irreps 256x0e
Irreps after layer are Irreps()

============================================================
TRAINING WITH TIMING
============================================================
[Allegro] Use two atom species for oxygen and hydroge.
[Allegro] Use default mask
Use a custom scatter implementation
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/ops/scatter.py:92: FutureWarning: scatter inputs have incompatible types: cannot safely cast value from dtype=float32 to dtype=int32 with jax_numpy_dtype_promotion='standard'. In future JAX releases this will result in an error.
  warnings.warn(
Out irreps 300x0e+556x1o+256x1e+556x2e+384x2o+512x3o+256x3e
Irreps after layer are 128x1o+128x1e+128x2e+128x2o+128x3o+128x3e
Use a custom scatter implementation
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/ops/scatter.py:92: FutureWarning: scatter inputs have incompatible types: cannot safely cast value from dtype=float32 to dtype=int32 with jax_numpy_dtype_promotion='standard'. In future JAX releases this will result in an error.
  warnings.warn(
Out irreps 256x0e+768x1o+896x2e
Irreps after layer are 128x1o+128x2e
Use a custom scatter implementation
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/ops/scatter.py:92: FutureWarning: scatter inputs have incompatible types: cannot safely cast value from dtype=float32 to dtype=int32 with jax_numpy_dtype_promotion='standard'. In future JAX releases this will result in an error.
  warnings.warn(
Out irreps 256x0e
Irreps after layer are Irreps()
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/numpy/lax_numpy.py:183: UserWarning: Explicitly requested dtype float64 requested in asarray is not available, and will be truncated to dtype float32. To enable more dtypes, set the jax_enable_x64 configuration option or the JAX_ENABLE_X64 shell environment variable. See https://github.com/jax-ml/jax#current-gotchas for more.
  return asarray(x, dtype=self.dtype)
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/numpy/reductions.py:213: UserWarning: Explicitly requested dtype <class 'jax.numpy.float64'> requested in sum is not available, and will be truncated to dtype float32. To enable more dtypes, set the jax_enable_x64 configuration option or the JAX_ENABLE_X64 shell environment variable. See https://github.com/jax-ml/jax#current-gotchas for more.
  return _reduction(a, "sum", np.sum, lax.add, 0, preproc=_cast_to_numeric,
[Force] Found precomputed forces.
[Force] Found precomputed forces.
[Epoch 0]:
	Average train loss: 132.25141
	Average val loss: 87.62896728515625
	Gradient norm: 2.446756362915039
	Elapsed time = 2.455 min
	Per-target losses:
		F | train loss: 132.25140745743462 | val loss: 87.62896728515625

[Epoch 1]:
	Average train loss: 85.51907
	Average val loss: 86.9555435180664
	Gradient norm: 4.774762153625488
	Elapsed time = 1.381 min
	Per-target losses:
		F | train loss: 85.51907332047172 | val loss: 86.9555435180664

[Epoch 2]:
	Average train loss: 84.44194
	Average val loss: 86.25534057617188
	Gradient norm: 7.370420932769775
	Elapsed time = 1.381 min
	Per-target losses:
		F | train loss: 84.44193981004798 | val loss: 86.25534057617188

[Training] 
Stage complete: train_loss=84.441940, val_loss=86.255341

Total training time: 356.04s
Timing data saved to: /p/project1/cameo/schmidt36/chemtrain-deploy/external/chemtrain/clean_code_base/scaling_results/run_20260202_172828/timing_3dev_13192056_3dev.json

============================================================
SCALING TEST COMPLETE
============================================================
  Total time: 387.800865151s
  Throughput: 17.40 samples/s

------------------------------------------------------------
Testing with 4 device(s)...
------------------------------------------------------------
  CUDA_VISIBLE_DEVICES=0,1,2,3
  Running training...
[Model] Using Allegro size: default
[Model] Detected 18 unique species
[Model] Using Allegro config size: default
[Model] Mode: Prior + Allegro
[Model] Prior weights: {'bond': 0.5, 'angle': 0.25, 'dihedral': 0.25, 'repulsive': 1.0}
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/ops/scatter.py:92: FutureWarning: scatter inputs have incompatible types: cannot safely cast value from dtype=float32 to dtype=int32 with jax_numpy_dtype_promotion='standard'. In future JAX releases this will result in an error.
  warnings.warn(
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/ops/scatter.py:92: FutureWarning: scatter inputs have incompatible types: cannot safely cast value from dtype=float32 to dtype=int32 with jax_numpy_dtype_promotion='standard'. In future JAX releases this will result in an error.
  warnings.warn(
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/ops/scatter.py:92: FutureWarning: scatter inputs have incompatible types: cannot safely cast value from dtype=float32 to dtype=int32 with jax_numpy_dtype_promotion='standard'. In future JAX releases this will result in an error.
  warnings.warn(
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/numpy/lax_numpy.py:183: UserWarning: Explicitly requested dtype float64 requested in asarray is not available, and will be truncated to dtype float32. To enable more dtypes, set the jax_enable_x64 configuration option or the JAX_ENABLE_X64 shell environment variable. See https://github.com/jax-ml/jax#current-gotchas for more.
  return asarray(x, dtype=self.dtype)
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/numpy/reductions.py:213: UserWarning: Explicitly requested dtype <class 'jax.numpy.float64'> requested in sum is not available, and will be truncated to dtype float32. To enable more dtypes, set the jax_enable_x64 configuration option or the JAX_ENABLE_X64 shell environment variable. See https://github.com/jax-ml/jax#current-gotchas for more.
  return _reduction(a, "sum", np.sum, lax.add, 0, preproc=_cast_to_numeric,
[Training] Initialized model with seed=193749
[Training] Applied NumpyDataLoader patch
[Training] 
============================================================
[Training] Training Stage: ADABELIEF (3 epochs, starting from 0)
[Training] ============================================================
/p/project1/cameo/schmidt36/chemtrain-deploy/external/chemtrain/chemtrain/trainers/base.py:957: UserWarning: Batch size 64 does not divide the number of observations 2250. Trainer will skip 10 samples for state training
  warnings.warn(
/p/project1/cameo/schmidt36/chemtrain-deploy/external/chemtrain/chemtrain/trainers/base.py:957: UserWarning: Batch size 64 does not divide the number of observations 250. Trainer will skip 58 samples for state validation
  warnings.warn(
[Scaling] Single-node mode: 4 device(s)
[Scaling] CUDA_VISIBLE_DEVICES = 0,1,2,3
[Rank 0] Local devices: [CudaDevice(id=0), CudaDevice(id=1), CudaDevice(id=2), CudaDevice(id=3)]
============================================================
SCALING TEST (FIXED)
============================================================
Expected devices: 4
Actual devices:   4
Distributed:      False
Rank:             0/1
Local devices:    4
============================================================
Capping edges and triplets. Beware of overflow, which is currently not being detected.
Estimated max. 900 edges.
[Allegro] Use two atom species for oxygen and hydroge.
[Allegro] Use default mask
Use a custom scatter implementation
Out irreps 300x0e+556x1o+256x1e+556x2e+384x2o+512x3o+256x3e
Irreps after layer are 128x1o+128x1e+128x2e+128x2o+128x3o+128x3e
Use a custom scatter implementation
Out irreps 256x0e+768x1o+896x2e
Irreps after layer are 128x1o+128x2e
Use a custom scatter implementation
Out irreps 256x0e
Irreps after layer are Irreps()

============================================================
TRAINING WITH TIMING
============================================================
[Allegro] Use two atom species for oxygen and hydroge.
[Allegro] Use default mask
Use a custom scatter implementation
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/ops/scatter.py:92: FutureWarning: scatter inputs have incompatible types: cannot safely cast value from dtype=float32 to dtype=int32 with jax_numpy_dtype_promotion='standard'. In future JAX releases this will result in an error.
  warnings.warn(
Out irreps 300x0e+556x1o+256x1e+556x2e+384x2o+512x3o+256x3e
Irreps after layer are 128x1o+128x1e+128x2e+128x2o+128x3o+128x3e
Use a custom scatter implementation
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/ops/scatter.py:92: FutureWarning: scatter inputs have incompatible types: cannot safely cast value from dtype=float32 to dtype=int32 with jax_numpy_dtype_promotion='standard'. In future JAX releases this will result in an error.
  warnings.warn(
Out irreps 256x0e+768x1o+896x2e
Irreps after layer are 128x1o+128x2e
Use a custom scatter implementation
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/ops/scatter.py:92: FutureWarning: scatter inputs have incompatible types: cannot safely cast value from dtype=float32 to dtype=int32 with jax_numpy_dtype_promotion='standard'. In future JAX releases this will result in an error.
  warnings.warn(
Out irreps 256x0e
Irreps after layer are Irreps()
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/numpy/lax_numpy.py:183: UserWarning: Explicitly requested dtype float64 requested in asarray is not available, and will be truncated to dtype float32. To enable more dtypes, set the jax_enable_x64 configuration option or the JAX_ENABLE_X64 shell environment variable. See https://github.com/jax-ml/jax#current-gotchas for more.
  return asarray(x, dtype=self.dtype)
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/numpy/reductions.py:213: UserWarning: Explicitly requested dtype <class 'jax.numpy.float64'> requested in sum is not available, and will be truncated to dtype float32. To enable more dtypes, set the jax_enable_x64 configuration option or the JAX_ENABLE_X64 shell environment variable. See https://github.com/jax-ml/jax#current-gotchas for more.
  return _reduction(a, "sum", np.sum, lax.add, 0, preproc=_cast_to_numeric,
[Force] Found precomputed forces.
[Force] Found precomputed forces.
[Epoch 0]:
	Average train loss: 145.78522
	Average val loss: 88.63709259033203
	Gradient norm: 23.16590690612793
	Elapsed time = 2.113 min
	Per-target losses:
		F | train loss: 145.78522447858538 | val loss: 88.63709259033203

[Epoch 1]:
	Average train loss: 86.02507
	Average val loss: 87.46432495117188
	Gradient norm: 3.204627513885498
	Elapsed time = 1.053 min
	Per-target losses:
		F | train loss: 86.02506713867187 | val loss: 87.46432495117188

[Epoch 2]:
	Average train loss: 84.86872
	Average val loss: 86.47947692871094
	Gradient norm: 28.343826293945312
	Elapsed time = 1.051 min
	Per-target losses:
		F | train loss: 84.86871861049107 | val loss: 86.47947692871094

[Training] 
Stage complete: train_loss=84.868719, val_loss=86.479477

Total training time: 286.22s
Timing data saved to: /p/project1/cameo/schmidt36/chemtrain-deploy/external/chemtrain/clean_code_base/scaling_results/run_20260202_172828/timing_4dev_13192056_4dev.json

============================================================
SCALING TEST COMPLETE
============================================================
  Total time: 319.253833013s
  Throughput: 21.14 samples/s

============================================================
Scaling test complete
Results saved to: /p/project1/cameo/schmidt36/chemtrain-deploy/external/chemtrain/clean_code_base/scaling_results/run_20260202_172828/timing_job_13192056.csv
============================================================
