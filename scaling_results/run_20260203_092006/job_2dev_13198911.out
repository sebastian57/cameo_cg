============================================================
Module Environment
============================================================

============================================================
SLURM Job Configuration
============================================================
Config file:    config_timing_test.yaml
Job ID:         13198911
Nodes:          2
Tasks/node:     1 (1 process per node)
GPUs per node:  4 (pmap distributes across local GPUs)
Total GPUs:     8
CUDA_HOME:      /p/software/juwelsbooster/stages/2025/software/CUDA/12
CUDA_VISIBLE:   0
============================================================
Verifying GPU allocation per node...
Host=jwb0161.juwels CUDA_VISIBLE_DEVICES=0
GPU 0: NVIDIA A100-SXM4-40GB (UUID: GPU-615f51c1-7916-1631-0e57-32d32f90853c)
GPU 1: NVIDIA A100-SXM4-40GB (UUID: GPU-f6a3e899-156d-9d7f-c02e-fafccb929fb3)
GPU 2: NVIDIA A100-SXM4-40GB (UUID: GPU-de02e312-a140-6653-8d03-365058738266)
GPU 3: NVIDIA A100-SXM4-40GB (UUID: GPU-234b3cf7-3d5f-fd4e-c412-a97de591d925)
Host=jwb0189.juwels CUDA_VISIBLE_DEVICES=0
GPU 0: NVIDIA A100-SXM4-40GB (UUID: GPU-7b239595-704d-a104-a321-289d6866425a)
GPU 1: NVIDIA A100-SXM4-40GB (UUID: GPU-2c66f288-3c93-c93b-33ec-5bc0bf5bbc25)
GPU 2: NVIDIA A100-SXM4-40GB (UUID: GPU-9978af7a-89bd-5c1a-b8dd-7be29bab2ed2)
GPU 3: NVIDIA A100-SXM4-40GB (UUID: GPU-18a073ea-499d-e90b-aeca-e38a9414396b)

============================================================
Multi-node JAX Distributed Verification
============================================================
Node=jwb0161.juwels SLURM_PROCID=0 SLURM_NTASKS=2
Node=jwb0189.juwels SLURM_PROCID=1 SLURM_NTASKS=2
JAX will auto-detect coordinator from SLURM environment
============================================================
Submit directory: /p/project1/cameo/schmidt36/chemtrain-deploy/external/chemtrain/clean_code_base
Training script:  /p/project1/cameo/schmidt36/chemtrain-deploy/external/chemtrain/clean_code_base/scripts/train.py
============================================================
Starting training with 2 node(s), 4 GPUs each...
Log file: train_allegro_13198911.log
============================================================
[Data] Resolved relative path: data_prep/datasets/2g4q4z5k_320K_kcalmol_1bead_notnorm_aggforce.npz -> /p/project1/cameo/schmidt36/chemtrain-deploy/external/chemtrain/clean_code_base/data_prep/datasets/2g4q4z5k_320K_kcalmol_1bead_notnorm_aggforce.npz
[Data] Resolved relative path: data_prep/datasets/2g4q4z5k_320K_kcalmol_1bead_notnorm_aggforce.npz -> /p/project1/cameo/schmidt36/chemtrain-deploy/external/chemtrain/clean_code_base/data_prep/datasets/2g4q4z5k_320K_kcalmol_1bead_notnorm_aggforce.npz
[Data] N_max: 99
[Data] N_max: 99
[Data] Species: [14 20 16 16 13 15  7 20 21 11 16  3  2 12  2  6  0 12  6 15 12  6  6  8
  5  3  0  1 16 12  0  7  7 10 17 12 11 16 14 12 13 12  1 12 11  1 16 17
 20 11 21  6 11 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1
 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1
 -1 -1 -1]
[Data] Total frames: 10000
[Data] Species: [14 20 16 16 13 15  7 20 21 11 16  3  2 12  2  6  0 12  6 15 12  6  6  8
  5  3  0  1 16 12  0  7  7 10 17 12 11 16 14 12 13 12  1 12 11  1 16 17
 20 11 21  6 11 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1
 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1
 -1 -1 -1]
[Data] Total frames: 10000
[Data] [Preprocessing] Computed box: [398.13    442.15002 444.7    ]
[Data] [Preprocessing] R_shift: [188.9     161.41    156.73001]
[Data] [Preprocessing] Computed box: [398.13    442.15002 444.7    ]
[Data] [Preprocessing] R_shift: [188.9     161.41    156.73001]
[Model] Using Allegro size: default
[Model] Using Allegro size: default
[Model] Detected 22 unique species
[Model] Using Allegro config size: default
[Model] Detected 22 unique species
[Model] Using Allegro config size: default
[Model] Mode: Prior + Allegro
[Model] Prior weights: {'bond': 0.5, 'angle': 0.25, 'dihedral': 0.25, 'repulsive': 1.0}
[Model] Initialized: CombinedModel(mode=Prior+Allegro, N_max=99)
[Data] [Split] Training: 8000, Validation: 2000
[Model] Mode: Prior + Allegro
[Model] Prior weights: {'bond': 0.5, 'angle': 0.25, 'dihedral': 0.25, 'repulsive': 1.0}
[Model] Initialized: CombinedModel(mode=Prior+Allegro, N_max=99)
[Data] [Split] Training: 8000, Validation: 2000
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/ops/scatter.py:92: FutureWarning: scatter inputs have incompatible types: cannot safely cast value from dtype=float32 to dtype=int32 with jax_numpy_dtype_promotion='standard'. In future JAX releases this will result in an error.
  warnings.warn(
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/ops/scatter.py:92: FutureWarning: scatter inputs have incompatible types: cannot safely cast value from dtype=float32 to dtype=int32 with jax_numpy_dtype_promotion='standard'. In future JAX releases this will result in an error.
  warnings.warn(
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/ops/scatter.py:92: FutureWarning: scatter inputs have incompatible types: cannot safely cast value from dtype=float32 to dtype=int32 with jax_numpy_dtype_promotion='standard'. In future JAX releases this will result in an error.
  warnings.warn(
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/ops/scatter.py:92: FutureWarning: scatter inputs have incompatible types: cannot safely cast value from dtype=float32 to dtype=int32 with jax_numpy_dtype_promotion='standard'. In future JAX releases this will result in an error.
  warnings.warn(
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/numpy/lax_numpy.py:183: UserWarning: Explicitly requested dtype float64 requested in asarray is not available, and will be truncated to dtype float32. To enable more dtypes, set the jax_enable_x64 configuration option or the JAX_ENABLE_X64 shell environment variable. See https://github.com/jax-ml/jax#current-gotchas for more.
  return asarray(x, dtype=self.dtype)
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/numpy/reductions.py:213: UserWarning: Explicitly requested dtype <class 'jax.numpy.float64'> requested in sum is not available, and will be truncated to dtype float32. To enable more dtypes, set the jax_enable_x64 configuration option or the JAX_ENABLE_X64 shell environment variable. See https://github.com/jax-ml/jax#current-gotchas for more.
  return _reduction(a, "sum", np.sum, lax.add, 0, preproc=_cast_to_numeric,
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/numpy/lax_numpy.py:183: UserWarning: Explicitly requested dtype float64 requested in asarray is not available, and will be truncated to dtype float32. To enable more dtypes, set the jax_enable_x64 configuration option or the JAX_ENABLE_X64 shell environment variable. See https://github.com/jax-ml/jax#current-gotchas for more.
  return asarray(x, dtype=self.dtype)
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/numpy/reductions.py:213: UserWarning: Explicitly requested dtype <class 'jax.numpy.float64'> requested in sum is not available, and will be truncated to dtype float32. To enable more dtypes, set the jax_enable_x64 configuration option or the JAX_ENABLE_X64 shell environment variable. See https://github.com/jax-ml/jax#current-gotchas for more.
  return _reduction(a, "sum", np.sum, lax.add, 0, preproc=_cast_to_numeric,
[Training] Initialized model with seed=8951
[Training] Applied NumpyDataLoader patch
[Training] 
============================================================
[Training] Prior Pre-Training (LBFGS, max_steps=200)
[Training] [Distributed] Running on rank 0, broadcasting to 2 processes
[Training] ============================================================
[Training] [LBFGS] Rank 1 waiting for broadcast from rank 0...
[Training] Initialized model with seed=8951
[Training] Applied NumpyDataLoader patch
[Training] 
============================================================
[Training] Prior Pre-Training (LBFGS, max_steps=200)
[Training] [Distributed] Running on rank 0, broadcasting to 2 processes
[Training] ============================================================
[Training] [LBFGS] Starting optimization on rank 0...
[Training] [LBFGS] Completed: 200 steps
[Training] [LBFGS] Final loss: 2.693446e+02
[Training] [LBFGS] Grad norm: 4.016101e+00 (tol=1.000000e-06)
[Training] [LBFGS] Converged: False
[Training] [LBFGS] Rank 0 received broadcasted parameters
[Training] 
[LBFGS] Fitted parameters:
[Training] [LBFGS] Rank 1 received broadcasted parameters
[Training] 
[LBFGS] Fitted parameters:
[Training]   a: [ 2.9412625  -3.46411    -2.611043    0.8783672   3.4381137   1.1767249
 -1.2840496  -4.293786   -0.91196495 -3.8550875 ]
[Training]   a: [ 2.9412625  -3.46411    -2.611043    0.8783672   3.4381137   1.1767249
 -1.2840496  -4.293786   -0.91196495 -3.8550875 ]
[Training]   b: [ 1.8633131   3.5983748  -3.1325958  -2.3873582  -0.9205838   3.5308986
  1.8498567   0.98156554 -4.577356   -3.735835  ]
[Training]   epsilon: 0.711690
[Training]   b: [ 1.8633131   3.5983748  -3.1325958  -2.3873582  -0.9205838   3.5308986
  1.8498567   0.98156554 -4.577356   -3.735835  ]
[Training]   epsilon: 0.711690
[Training]   gamma_dih: [-6.1192303 -3.3317766]
[Training]   gamma_dih: [-6.1192303 -3.3317766]
[Training]   k_dih: [ 5.0111823 -0.3663226]
[Training]   kr: 281.325348
[Training]   k_dih: [ 5.0111823 -0.3663226]
[Training]   r0: 3.839330
[Training]   sigma: -1.194348
[Training]   kr: 281.325348
[Training]   r0: 3.839330
[Training]   sigma: -1.194348
[Training] 
============================================================
[Training] Training Stage: ADABELIEF (20 epochs, starting from 0)
[Training] ============================================================
[Training] 
============================================================
[Training] Training Stage: ADABELIEF (20 epochs, starting from 0)
[Training] ============================================================
[SLURM] Detected multi-node job: 2 tasks
[SLURM] Process 0/2
[SLURM] Coordinator: jwb0161.juwels:30311
[SLURM] CUDA_VISIBLE_DEVICES=0 -> 1 local GPUs
[Rank 0/2] JAX distributed initialized
[Rank 0] Local GPUs: 1, Total GPUs: 2
[Rank 0] CUDA_VISIBLE_DEVICES: 0
WARNING: Expected 4 local GPUs per process (1 process per node), got 1
WARNING: Expected 8 total GPUs (2 nodes × 4 GPUs), got 2
[Rank 0] Local devices: [CudaDevice(id=0)]
[Rank 0] All devices: [CudaDevice(id=0), CudaDevice(id=1)]
Capping edges and triplets. Beware of overflow, which is currently not being detected.
Estimated max. 3488 edges.
[Allegro] Use two atom species for oxygen and hydroge.
[Allegro] Use default mask
Use a custom scatter implementation
Out irreps 300x0e+556x1o+556x2e
Irreps after layer are 128x1o+128x2e
Use a custom scatter implementation
Out irreps 256x0e
Irreps after layer are Irreps()
[Allegro] Use two atom species for oxygen and hydroge.
[Allegro] Use default mask
[SLURM] Detected multi-node job: 2 tasks
[SLURM] Process 1/2
[SLURM] Coordinator: jwb0161.juwels:30311
[SLURM] CUDA_VISIBLE_DEVICES=0 -> 1 local GPUs
[Rank 1/2] JAX distributed initialized
[Rank 1] Local GPUs: 1, Total GPUs: 2
[Rank 1] CUDA_VISIBLE_DEVICES: 0
WARNING: Expected 4 local GPUs per process (1 process per node), got 1
WARNING: Expected 8 total GPUs (2 nodes × 4 GPUs), got 2
[Rank 1] Local devices: [CudaDevice(id=1)]
[Rank 1] All devices: [CudaDevice(id=0), CudaDevice(id=1)]
Capping edges and triplets. Beware of overflow, which is currently not being detected.
Estimated max. 3488 edges.
[Allegro] Use two atom species for oxygen and hydroge.
[Allegro] Use default mask
Use a custom scatter implementation
Out irreps 300x0e+556x1o+556x2e
Irreps after layer are 128x1o+128x2e
Use a custom scatter implementation
Out irreps 256x0e
Irreps after layer are Irreps()
[Allegro] Use two atom species for oxygen and hydroge.
[Allegro] Use default mask
Use a custom scatter implementation
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/ops/scatter.py:92: FutureWarning: scatter inputs have incompatible types: cannot safely cast value from dtype=float32 to dtype=int32 with jax_numpy_dtype_promotion='standard'. In future JAX releases this will result in an error.
  warnings.warn(
Out irreps 300x0e+556x1o+556x2e
Irreps after layer are 128x1o+128x2e
Use a custom scatter implementation
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/ops/scatter.py:92: FutureWarning: scatter inputs have incompatible types: cannot safely cast value from dtype=float32 to dtype=int32 with jax_numpy_dtype_promotion='standard'. In future JAX releases this will result in an error.
  warnings.warn(
Out irreps 256x0e
Irreps after layer are Irreps()
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/numpy/lax_numpy.py:183: UserWarning: Explicitly requested dtype float64 requested in asarray is not available, and will be truncated to dtype float32. To enable more dtypes, set the jax_enable_x64 configuration option or the JAX_ENABLE_X64 shell environment variable. See https://github.com/jax-ml/jax#current-gotchas for more.
  return asarray(x, dtype=self.dtype)
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/numpy/reductions.py:213: UserWarning: Explicitly requested dtype <class 'jax.numpy.float64'> requested in sum is not available, and will be truncated to dtype float32. To enable more dtypes, set the jax_enable_x64 configuration option or the JAX_ENABLE_X64 shell environment variable. See https://github.com/jax-ml/jax#current-gotchas for more.
  return _reduction(a, "sum", np.sum, lax.add, 0, preproc=_cast_to_numeric,
Use a custom scatter implementation
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/ops/scatter.py:92: FutureWarning: scatter inputs have incompatible types: cannot safely cast value from dtype=float32 to dtype=int32 with jax_numpy_dtype_promotion='standard'. In future JAX releases this will result in an error.
  warnings.warn(
Out irreps 300x0e+556x1o+556x2e
Irreps after layer are 128x1o+128x2e
Use a custom scatter implementation
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/ops/scatter.py:92: FutureWarning: scatter inputs have incompatible types: cannot safely cast value from dtype=float32 to dtype=int32 with jax_numpy_dtype_promotion='standard'. In future JAX releases this will result in an error.
  warnings.warn(
Out irreps 256x0e
Irreps after layer are Irreps()
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/numpy/lax_numpy.py:183: UserWarning: Explicitly requested dtype float64 requested in asarray is not available, and will be truncated to dtype float32. To enable more dtypes, set the jax_enable_x64 configuration option or the JAX_ENABLE_X64 shell environment variable. See https://github.com/jax-ml/jax#current-gotchas for more.
  return asarray(x, dtype=self.dtype)
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/numpy/reductions.py:213: UserWarning: Explicitly requested dtype <class 'jax.numpy.float64'> requested in sum is not available, and will be truncated to dtype float32. To enable more dtypes, set the jax_enable_x64 configuration option or the JAX_ENABLE_X64 shell environment variable. See https://github.com/jax-ml/jax#current-gotchas for more.
  return _reduction(a, "sum", np.sum, lax.add, 0, preproc=_cast_to_numeric,
[Force] Found precomputed forces.
[Force] Found precomputed forces.
