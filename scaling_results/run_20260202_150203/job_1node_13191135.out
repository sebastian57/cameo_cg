============================================================
Scaling Test Worker
============================================================
Job ID:         13191135
Nodes:          1
Start devices:  1
End devices:    4
Config:         /p/project1/cameo/schmidt36/chemtrain-deploy/external/chemtrain/clean_code_base/scripts/config_scaling_test.yaml
Output dir:     /p/project1/cameo/schmidt36/chemtrain-deploy/external/chemtrain/clean_code_base/scaling_results/run_20260202_150203
============================================================

============================================================
Starting scaling tests from 1 to 4 devices
============================================================

------------------------------------------------------------
Testing with 1 device(s)...
------------------------------------------------------------
  Nodes needed:     1
  Device pattern:   split:0x4+1
  Running training...
[Model] Using Allegro size: default
[Model] Detected 18 unique species
[Model] Using Allegro config size: default
[Model] Mode: Prior + Allegro
[Model] Prior weights: {'bond': 0.5, 'angle': 0.25, 'dihedral': 0.25, 'repulsive': 1.0}
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/ops/scatter.py:92: FutureWarning: scatter inputs have incompatible types: cannot safely cast value from dtype=float32 to dtype=int32 with jax_numpy_dtype_promotion='standard'. In future JAX releases this will result in an error.
  warnings.warn(
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/ops/scatter.py:92: FutureWarning: scatter inputs have incompatible types: cannot safely cast value from dtype=float32 to dtype=int32 with jax_numpy_dtype_promotion='standard'. In future JAX releases this will result in an error.
  warnings.warn(
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/ops/scatter.py:92: FutureWarning: scatter inputs have incompatible types: cannot safely cast value from dtype=float32 to dtype=int32 with jax_numpy_dtype_promotion='standard'. In future JAX releases this will result in an error.
  warnings.warn(
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/numpy/lax_numpy.py:183: UserWarning: Explicitly requested dtype float64 requested in asarray is not available, and will be truncated to dtype float32. To enable more dtypes, set the jax_enable_x64 configuration option or the JAX_ENABLE_X64 shell environment variable. See https://github.com/jax-ml/jax#current-gotchas for more.
  return asarray(x, dtype=self.dtype)
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/numpy/reductions.py:213: UserWarning: Explicitly requested dtype <class 'jax.numpy.float64'> requested in sum is not available, and will be truncated to dtype float32. To enable more dtypes, set the jax_enable_x64 configuration option or the JAX_ENABLE_X64 shell environment variable. See https://github.com/jax-ml/jax#current-gotchas for more.
  return _reduction(a, "sum", np.sum, lax.add, 0, preproc=_cast_to_numeric,
[Training] Initialized model with seed=193749
[Training] Applied NumpyDataLoader patch
[Training] 
============================================================
[Training] Training Stage: ADABELIEF (3 epochs, starting from 0)
[Training] ============================================================
/p/project1/cameo/schmidt36/chemtrain-deploy/external/chemtrain/chemtrain/trainers/base.py:957: UserWarning: Batch size 16 does not divide the number of observations 2250. Trainer will skip 10 samples for state training
  warnings.warn(
/p/project1/cameo/schmidt36/chemtrain-deploy/external/chemtrain/chemtrain/trainers/base.py:957: UserWarning: Batch size 16 does not divide the number of observations 250. Trainer will skip 10 samples for state validation
  warnings.warn(
[Scaling] Single-node: CUDA_VISIBLE_DEVICES = 0
[Single-process mode] Local devices: 1
[Rank 0] Local devices: [CudaDevice(id=0)]
============================================================
SCALING TEST
============================================================
Devices: 1
Distributed: False
Rank: 0/1
Local devices: 1
Global devices: 1
============================================================
Capping edges and triplets. Beware of overflow, which is currently not being detected.
Estimated max. 900 edges.
[Allegro] Use two atom species for oxygen and hydroge.
[Allegro] Use default mask
Use a custom scatter implementation
Out irreps 300x0e+556x1o+256x1e+556x2e+384x2o+512x3o+256x3e
Irreps after layer are 128x1o+128x1e+128x2e+128x2o+128x3o+128x3e
Use a custom scatter implementation
Out irreps 256x0e+768x1o+896x2e
Irreps after layer are 128x1o+128x2e
Use a custom scatter implementation
Out irreps 256x0e
Irreps after layer are Irreps()

============================================================
TRAINING WITH TIMING
============================================================
[Allegro] Use two atom species for oxygen and hydroge.
[Allegro] Use default mask
Use a custom scatter implementation
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/ops/scatter.py:92: FutureWarning: scatter inputs have incompatible types: cannot safely cast value from dtype=float32 to dtype=int32 with jax_numpy_dtype_promotion='standard'. In future JAX releases this will result in an error.
  warnings.warn(
Out irreps 300x0e+556x1o+256x1e+556x2e+384x2o+512x3o+256x3e
Irreps after layer are 128x1o+128x1e+128x2e+128x2o+128x3o+128x3e
Use a custom scatter implementation
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/ops/scatter.py:92: FutureWarning: scatter inputs have incompatible types: cannot safely cast value from dtype=float32 to dtype=int32 with jax_numpy_dtype_promotion='standard'. In future JAX releases this will result in an error.
  warnings.warn(
Out irreps 256x0e+768x1o+896x2e
Irreps after layer are 128x1o+128x2e
Use a custom scatter implementation
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/ops/scatter.py:92: FutureWarning: scatter inputs have incompatible types: cannot safely cast value from dtype=float32 to dtype=int32 with jax_numpy_dtype_promotion='standard'. In future JAX releases this will result in an error.
  warnings.warn(
Out irreps 256x0e
Irreps after layer are Irreps()
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/numpy/lax_numpy.py:183: UserWarning: Explicitly requested dtype float64 requested in asarray is not available, and will be truncated to dtype float32. To enable more dtypes, set the jax_enable_x64 configuration option or the JAX_ENABLE_X64 shell environment variable. See https://github.com/jax-ml/jax#current-gotchas for more.
  return asarray(x, dtype=self.dtype)
[Force] Found precomputed forces.
[Force] Found precomputed forces.
[Epoch 0]:
	Average train loss: 102.02167
	Average val loss: 86.51502990722656
	Gradient norm: 8.71644401550293
	Elapsed time = 5.096 min
	Per-target losses:
		F | train loss: 102.02167015075683 | val loss: 86.51502990722656

[Epoch 1]:
	Average train loss: 84.68740
	Average val loss: 86.49359130859375
	Gradient norm: 5.884149551391602
	Elapsed time = 4.230 min
	Per-target losses:
		F | train loss: 84.68740452357702 | val loss: 86.49359130859375

[Epoch 2]:
	Average train loss: 84.08882
	Average val loss: 85.68199920654297
	Gradient norm: 6.117431163787842
	Elapsed time = 4.230 min
	Per-target losses:
		F | train loss: 84.08882064819336 | val loss: 85.68199920654297

[Training] 
Stage complete: train_loss=84.088821, val_loss=85.681999

Total training time: 898.65s
Timing data saved to: /p/project1/cameo/schmidt36/chemtrain-deploy/external/chemtrain/clean_code_base/scaling_results/run_20260202_150203/timing_1dev_13191135_1dev.json

============================================================
SCALING TEST COMPLETE
============================================================
  Total time: 950.481643770s
  Throughput: 7.10 samples/s
  Done with 1 devices

------------------------------------------------------------
Testing with 2 device(s)...
------------------------------------------------------------
  Nodes needed:     1
  Device pattern:   split:0x4+2
  Running training...
[Model] Using Allegro size: default
[Model] Detected 18 unique species
[Model] Using Allegro config size: default
[Model] Mode: Prior + Allegro
[Model] Prior weights: {'bond': 0.5, 'angle': 0.25, 'dihedral': 0.25, 'repulsive': 1.0}
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/ops/scatter.py:92: FutureWarning: scatter inputs have incompatible types: cannot safely cast value from dtype=float32 to dtype=int32 with jax_numpy_dtype_promotion='standard'. In future JAX releases this will result in an error.
  warnings.warn(
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/ops/scatter.py:92: FutureWarning: scatter inputs have incompatible types: cannot safely cast value from dtype=float32 to dtype=int32 with jax_numpy_dtype_promotion='standard'. In future JAX releases this will result in an error.
  warnings.warn(
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/ops/scatter.py:92: FutureWarning: scatter inputs have incompatible types: cannot safely cast value from dtype=float32 to dtype=int32 with jax_numpy_dtype_promotion='standard'. In future JAX releases this will result in an error.
  warnings.warn(
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/numpy/lax_numpy.py:183: UserWarning: Explicitly requested dtype float64 requested in asarray is not available, and will be truncated to dtype float32. To enable more dtypes, set the jax_enable_x64 configuration option or the JAX_ENABLE_X64 shell environment variable. See https://github.com/jax-ml/jax#current-gotchas for more.
  return asarray(x, dtype=self.dtype)
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/numpy/reductions.py:213: UserWarning: Explicitly requested dtype <class 'jax.numpy.float64'> requested in sum is not available, and will be truncated to dtype float32. To enable more dtypes, set the jax_enable_x64 configuration option or the JAX_ENABLE_X64 shell environment variable. See https://github.com/jax-ml/jax#current-gotchas for more.
  return _reduction(a, "sum", np.sum, lax.add, 0, preproc=_cast_to_numeric,
[Training] Initialized model with seed=193749
[Training] Applied NumpyDataLoader patch
[Training] 
============================================================
[Training] Training Stage: ADABELIEF (3 epochs, starting from 0)
[Training] ============================================================
/p/project1/cameo/schmidt36/chemtrain-deploy/external/chemtrain/chemtrain/trainers/base.py:957: UserWarning: Batch size 32 does not divide the number of observations 2250. Trainer will skip 10 samples for state training
  warnings.warn(
/p/project1/cameo/schmidt36/chemtrain-deploy/external/chemtrain/chemtrain/trainers/base.py:957: UserWarning: Batch size 32 does not divide the number of observations 250. Trainer will skip 26 samples for state validation
  warnings.warn(
[Scaling] Single-node: CUDA_VISIBLE_DEVICES = 0,1
[Single-process mode] Local devices: 2
[Rank 0] Local devices: [CudaDevice(id=0), CudaDevice(id=1)]
============================================================
SCALING TEST
============================================================
Devices: 2
Distributed: False
Rank: 0/1
Local devices: 2
Global devices: 2
============================================================
Capping edges and triplets. Beware of overflow, which is currently not being detected.
Estimated max. 900 edges.
[Allegro] Use two atom species for oxygen and hydroge.
[Allegro] Use default mask
Use a custom scatter implementation
Out irreps 300x0e+556x1o+256x1e+556x2e+384x2o+512x3o+256x3e
Irreps after layer are 128x1o+128x1e+128x2e+128x2o+128x3o+128x3e
Use a custom scatter implementation
Out irreps 256x0e+768x1o+896x2e
Irreps after layer are 128x1o+128x2e
Use a custom scatter implementation
Out irreps 256x0e
Irreps after layer are Irreps()

============================================================
TRAINING WITH TIMING
============================================================
[Allegro] Use two atom species for oxygen and hydroge.
[Allegro] Use default mask
Use a custom scatter implementation
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/ops/scatter.py:92: FutureWarning: scatter inputs have incompatible types: cannot safely cast value from dtype=float32 to dtype=int32 with jax_numpy_dtype_promotion='standard'. In future JAX releases this will result in an error.
  warnings.warn(
Out irreps 300x0e+556x1o+256x1e+556x2e+384x2o+512x3o+256x3e
Irreps after layer are 128x1o+128x1e+128x2e+128x2o+128x3o+128x3e
Use a custom scatter implementation
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/ops/scatter.py:92: FutureWarning: scatter inputs have incompatible types: cannot safely cast value from dtype=float32 to dtype=int32 with jax_numpy_dtype_promotion='standard'. In future JAX releases this will result in an error.
  warnings.warn(
Out irreps 256x0e+768x1o+896x2e
Irreps after layer are 128x1o+128x2e
Use a custom scatter implementation
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/ops/scatter.py:92: FutureWarning: scatter inputs have incompatible types: cannot safely cast value from dtype=float32 to dtype=int32 with jax_numpy_dtype_promotion='standard'. In future JAX releases this will result in an error.
  warnings.warn(
Out irreps 256x0e
Irreps after layer are Irreps()
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/numpy/lax_numpy.py:183: UserWarning: Explicitly requested dtype float64 requested in asarray is not available, and will be truncated to dtype float32. To enable more dtypes, set the jax_enable_x64 configuration option or the JAX_ENABLE_X64 shell environment variable. See https://github.com/jax-ml/jax#current-gotchas for more.
  return asarray(x, dtype=self.dtype)
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/numpy/reductions.py:213: UserWarning: Explicitly requested dtype <class 'jax.numpy.float64'> requested in sum is not available, and will be truncated to dtype float32. To enable more dtypes, set the jax_enable_x64 configuration option or the JAX_ENABLE_X64 shell environment variable. See https://github.com/jax-ml/jax#current-gotchas for more.
  return _reduction(a, "sum", np.sum, lax.add, 0, preproc=_cast_to_numeric,
[Force] Found precomputed forces.
[Force] Found precomputed forces.
[Epoch 0]:
	Average train loss: 116.22562
	Average val loss: 86.80532836914062
	Gradient norm: 6.689197063446045
	Elapsed time = 3.071 min
	Per-target losses:
		F | train loss: 116.22561896187919 | val loss: 86.80532836914062

[Epoch 1]:
	Average train loss: 84.97906
	Average val loss: 86.28840637207031
	Gradient norm: 6.66058349609375
	Elapsed time = 2.068 min
	Per-target losses:
		F | train loss: 84.97906188964843 | val loss: 86.28840637207031

[Epoch 2]:
	Average train loss: 84.33372
	Average val loss: 86.15665435791016
	Gradient norm: 7.492161750793457
	Elapsed time = 2.068 min
	Per-target losses:
		F | train loss: 84.3337173461914 | val loss: 86.15665435791016

[Training] 
Stage complete: train_loss=84.333717, val_loss=86.156654

Total training time: 484.27s
Timing data saved to: /p/project1/cameo/schmidt36/chemtrain-deploy/external/chemtrain/clean_code_base/scaling_results/run_20260202_150203/timing_2dev_13191135_2dev.json

============================================================
SCALING TEST COMPLETE
============================================================
  Total time: 520.837904962s
  Throughput: 12.95 samples/s
  Done with 2 devices

------------------------------------------------------------
Testing with 3 device(s)...
------------------------------------------------------------
  Nodes needed:     1
  Device pattern:   split:0x4+3
  Running training...
[Model] Using Allegro size: default
[Model] Detected 18 unique species
[Model] Using Allegro config size: default
[Model] Mode: Prior + Allegro
[Model] Prior weights: {'bond': 0.5, 'angle': 0.25, 'dihedral': 0.25, 'repulsive': 1.0}
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/ops/scatter.py:92: FutureWarning: scatter inputs have incompatible types: cannot safely cast value from dtype=float32 to dtype=int32 with jax_numpy_dtype_promotion='standard'. In future JAX releases this will result in an error.
  warnings.warn(
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/ops/scatter.py:92: FutureWarning: scatter inputs have incompatible types: cannot safely cast value from dtype=float32 to dtype=int32 with jax_numpy_dtype_promotion='standard'. In future JAX releases this will result in an error.
  warnings.warn(
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/ops/scatter.py:92: FutureWarning: scatter inputs have incompatible types: cannot safely cast value from dtype=float32 to dtype=int32 with jax_numpy_dtype_promotion='standard'. In future JAX releases this will result in an error.
  warnings.warn(
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/numpy/lax_numpy.py:183: UserWarning: Explicitly requested dtype float64 requested in asarray is not available, and will be truncated to dtype float32. To enable more dtypes, set the jax_enable_x64 configuration option or the JAX_ENABLE_X64 shell environment variable. See https://github.com/jax-ml/jax#current-gotchas for more.
  return asarray(x, dtype=self.dtype)
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/numpy/reductions.py:213: UserWarning: Explicitly requested dtype <class 'jax.numpy.float64'> requested in sum is not available, and will be truncated to dtype float32. To enable more dtypes, set the jax_enable_x64 configuration option or the JAX_ENABLE_X64 shell environment variable. See https://github.com/jax-ml/jax#current-gotchas for more.
  return _reduction(a, "sum", np.sum, lax.add, 0, preproc=_cast_to_numeric,
[Training] Initialized model with seed=193749
[Training] Applied NumpyDataLoader patch
[Training] 
============================================================
[Training] Training Stage: ADABELIEF (3 epochs, starting from 0)
[Training] ============================================================
/p/project1/cameo/schmidt36/chemtrain-deploy/external/chemtrain/chemtrain/trainers/base.py:957: UserWarning: Batch size 48 does not divide the number of observations 2250. Trainer will skip 42 samples for state training
  warnings.warn(
/p/project1/cameo/schmidt36/chemtrain-deploy/external/chemtrain/chemtrain/trainers/base.py:957: UserWarning: Batch size 48 does not divide the number of observations 250. Trainer will skip 10 samples for state validation
  warnings.warn(
[Scaling] Single-node: CUDA_VISIBLE_DEVICES = 0,1,2
[Single-process mode] Local devices: 3
[Rank 0] Local devices: [CudaDevice(id=0), CudaDevice(id=1), CudaDevice(id=2)]
============================================================
SCALING TEST
============================================================
Devices: 3
Distributed: False
Rank: 0/1
Local devices: 3
Global devices: 3
============================================================
Capping edges and triplets. Beware of overflow, which is currently not being detected.
Estimated max. 900 edges.
[Allegro] Use two atom species for oxygen and hydroge.
[Allegro] Use default mask
Use a custom scatter implementation
Out irreps 300x0e+556x1o+256x1e+556x2e+384x2o+512x3o+256x3e
Irreps after layer are 128x1o+128x1e+128x2e+128x2o+128x3o+128x3e
Use a custom scatter implementation
Out irreps 256x0e+768x1o+896x2e
Irreps after layer are 128x1o+128x2e
Use a custom scatter implementation
Out irreps 256x0e
Irreps after layer are Irreps()

============================================================
TRAINING WITH TIMING
============================================================
[Allegro] Use two atom species for oxygen and hydroge.
[Allegro] Use default mask
Use a custom scatter implementation
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/ops/scatter.py:92: FutureWarning: scatter inputs have incompatible types: cannot safely cast value from dtype=float32 to dtype=int32 with jax_numpy_dtype_promotion='standard'. In future JAX releases this will result in an error.
  warnings.warn(
Out irreps 300x0e+556x1o+256x1e+556x2e+384x2o+512x3o+256x3e
Irreps after layer are 128x1o+128x1e+128x2e+128x2o+128x3o+128x3e
Use a custom scatter implementation
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/ops/scatter.py:92: FutureWarning: scatter inputs have incompatible types: cannot safely cast value from dtype=float32 to dtype=int32 with jax_numpy_dtype_promotion='standard'. In future JAX releases this will result in an error.
  warnings.warn(
Out irreps 256x0e+768x1o+896x2e
Irreps after layer are 128x1o+128x2e
Use a custom scatter implementation
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/ops/scatter.py:92: FutureWarning: scatter inputs have incompatible types: cannot safely cast value from dtype=float32 to dtype=int32 with jax_numpy_dtype_promotion='standard'. In future JAX releases this will result in an error.
  warnings.warn(
Out irreps 256x0e
Irreps after layer are Irreps()
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/numpy/lax_numpy.py:183: UserWarning: Explicitly requested dtype float64 requested in asarray is not available, and will be truncated to dtype float32. To enable more dtypes, set the jax_enable_x64 configuration option or the JAX_ENABLE_X64 shell environment variable. See https://github.com/jax-ml/jax#current-gotchas for more.
  return asarray(x, dtype=self.dtype)
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/numpy/reductions.py:213: UserWarning: Explicitly requested dtype <class 'jax.numpy.float64'> requested in sum is not available, and will be truncated to dtype float32. To enable more dtypes, set the jax_enable_x64 configuration option or the JAX_ENABLE_X64 shell environment variable. See https://github.com/jax-ml/jax#current-gotchas for more.
  return _reduction(a, "sum", np.sum, lax.add, 0, preproc=_cast_to_numeric,
[Force] Found precomputed forces.
[Force] Found precomputed forces.
[Epoch 0]:
	Average train loss: 132.25106
	Average val loss: 87.62904357910156
	Gradient norm: 2.444117784500122
	Elapsed time = 2.395 min
	Per-target losses:
		F | train loss: 132.25105932484502 | val loss: 87.62904357910156

[Epoch 1]:
	Average train loss: 85.51921
	Average val loss: 86.95543670654297
	Gradient norm: 4.769490718841553
	Elapsed time = 1.391 min
	Per-target losses:
		F | train loss: 85.51920982029127 | val loss: 86.95543670654297

[Epoch 2]:
	Average train loss: 84.44142
	Average val loss: 86.25587463378906
	Gradient norm: 7.417940616607666
	Elapsed time = 1.390 min
	Per-target losses:
		F | train loss: 84.44142250392748 | val loss: 86.25587463378906

[Training] 
Stage complete: train_loss=84.441423, val_loss=86.255875

Total training time: 352.43s
Timing data saved to: /p/project1/cameo/schmidt36/chemtrain-deploy/external/chemtrain/clean_code_base/scaling_results/run_20260202_150203/timing_3dev_13191135_3dev.json

============================================================
SCALING TEST COMPLETE
============================================================
  Total time: 389.918076760s
  Throughput: 17.31 samples/s
  Done with 3 devices

------------------------------------------------------------
Testing with 4 device(s)...
------------------------------------------------------------
  Nodes needed:     1
  Device pattern:   uniform:4
  Running training...
[Model] Using Allegro size: default
[Model] Detected 18 unique species
[Model] Using Allegro config size: default
[Model] Mode: Prior + Allegro
[Model] Prior weights: {'bond': 0.5, 'angle': 0.25, 'dihedral': 0.25, 'repulsive': 1.0}
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/ops/scatter.py:92: FutureWarning: scatter inputs have incompatible types: cannot safely cast value from dtype=float32 to dtype=int32 with jax_numpy_dtype_promotion='standard'. In future JAX releases this will result in an error.
  warnings.warn(
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/ops/scatter.py:92: FutureWarning: scatter inputs have incompatible types: cannot safely cast value from dtype=float32 to dtype=int32 with jax_numpy_dtype_promotion='standard'. In future JAX releases this will result in an error.
  warnings.warn(
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/ops/scatter.py:92: FutureWarning: scatter inputs have incompatible types: cannot safely cast value from dtype=float32 to dtype=int32 with jax_numpy_dtype_promotion='standard'. In future JAX releases this will result in an error.
  warnings.warn(
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/numpy/lax_numpy.py:183: UserWarning: Explicitly requested dtype float64 requested in asarray is not available, and will be truncated to dtype float32. To enable more dtypes, set the jax_enable_x64 configuration option or the JAX_ENABLE_X64 shell environment variable. See https://github.com/jax-ml/jax#current-gotchas for more.
  return asarray(x, dtype=self.dtype)
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/numpy/reductions.py:213: UserWarning: Explicitly requested dtype <class 'jax.numpy.float64'> requested in sum is not available, and will be truncated to dtype float32. To enable more dtypes, set the jax_enable_x64 configuration option or the JAX_ENABLE_X64 shell environment variable. See https://github.com/jax-ml/jax#current-gotchas for more.
  return _reduction(a, "sum", np.sum, lax.add, 0, preproc=_cast_to_numeric,
[Training] Initialized model with seed=193749
[Training] Applied NumpyDataLoader patch
[Training] 
============================================================
[Training] Training Stage: ADABELIEF (3 epochs, starting from 0)
[Training] ============================================================
/p/project1/cameo/schmidt36/chemtrain-deploy/external/chemtrain/chemtrain/trainers/base.py:957: UserWarning: Batch size 64 does not divide the number of observations 2250. Trainer will skip 10 samples for state training
  warnings.warn(
/p/project1/cameo/schmidt36/chemtrain-deploy/external/chemtrain/chemtrain/trainers/base.py:957: UserWarning: Batch size 64 does not divide the number of observations 250. Trainer will skip 58 samples for state validation
  warnings.warn(
[Scaling] Single-node: CUDA_VISIBLE_DEVICES = 0,1,2,3
[Single-process mode] Local devices: 4
[Rank 0] Local devices: [CudaDevice(id=0), CudaDevice(id=1), CudaDevice(id=2), CudaDevice(id=3)]
============================================================
SCALING TEST
============================================================
Devices: 4
Distributed: False
Rank: 0/1
Local devices: 4
Global devices: 4
============================================================
Capping edges and triplets. Beware of overflow, which is currently not being detected.
Estimated max. 900 edges.
[Allegro] Use two atom species for oxygen and hydroge.
[Allegro] Use default mask
Use a custom scatter implementation
Out irreps 300x0e+556x1o+256x1e+556x2e+384x2o+512x3o+256x3e
Irreps after layer are 128x1o+128x1e+128x2e+128x2o+128x3o+128x3e
Use a custom scatter implementation
Out irreps 256x0e+768x1o+896x2e
Irreps after layer are 128x1o+128x2e
Use a custom scatter implementation
Out irreps 256x0e
Irreps after layer are Irreps()

============================================================
TRAINING WITH TIMING
============================================================
[Allegro] Use two atom species for oxygen and hydroge.
[Allegro] Use default mask
Use a custom scatter implementation
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/ops/scatter.py:92: FutureWarning: scatter inputs have incompatible types: cannot safely cast value from dtype=float32 to dtype=int32 with jax_numpy_dtype_promotion='standard'. In future JAX releases this will result in an error.
  warnings.warn(
Out irreps 300x0e+556x1o+256x1e+556x2e+384x2o+512x3o+256x3e
Irreps after layer are 128x1o+128x1e+128x2e+128x2o+128x3o+128x3e
Use a custom scatter implementation
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/ops/scatter.py:92: FutureWarning: scatter inputs have incompatible types: cannot safely cast value from dtype=float32 to dtype=int32 with jax_numpy_dtype_promotion='standard'. In future JAX releases this will result in an error.
  warnings.warn(
Out irreps 256x0e+768x1o+896x2e
Irreps after layer are 128x1o+128x2e
Use a custom scatter implementation
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/ops/scatter.py:92: FutureWarning: scatter inputs have incompatible types: cannot safely cast value from dtype=float32 to dtype=int32 with jax_numpy_dtype_promotion='standard'. In future JAX releases this will result in an error.
  warnings.warn(
Out irreps 256x0e
Irreps after layer are Irreps()
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/numpy/lax_numpy.py:183: UserWarning: Explicitly requested dtype float64 requested in asarray is not available, and will be truncated to dtype float32. To enable more dtypes, set the jax_enable_x64 configuration option or the JAX_ENABLE_X64 shell environment variable. See https://github.com/jax-ml/jax#current-gotchas for more.
  return asarray(x, dtype=self.dtype)
/p/software/default/stages/2025/software/jax/0.4.34-gpsfbf-2024a-CUDA-12/lib/python3.12/site-packages/jax/_src/numpy/reductions.py:213: UserWarning: Explicitly requested dtype <class 'jax.numpy.float64'> requested in sum is not available, and will be truncated to dtype float32. To enable more dtypes, set the jax_enable_x64 configuration option or the JAX_ENABLE_X64 shell environment variable. See https://github.com/jax-ml/jax#current-gotchas for more.
  return _reduction(a, "sum", np.sum, lax.add, 0, preproc=_cast_to_numeric,
[Force] Found precomputed forces.
[Force] Found precomputed forces.
[Epoch 0]:
	Average train loss: 145.78203
	Average val loss: 88.63666534423828
	Gradient norm: 23.22177505493164
	Elapsed time = 2.082 min
	Per-target losses:
		F | train loss: 145.78202580043248 | val loss: 88.63666534423828

[Epoch 1]:
	Average train loss: 86.02400
	Average val loss: 87.46330261230469
	Gradient norm: 3.2466819286346436
	Elapsed time = 1.063 min
	Per-target losses:
		F | train loss: 86.0239998953683 | val loss: 87.46330261230469

[Epoch 2]:
	Average train loss: 84.86800
	Average val loss: 86.46849060058594
	Gradient norm: 27.82424545288086
	Elapsed time = 1.062 min
	Per-target losses:
		F | train loss: 84.86799643380301 | val loss: 86.46849060058594

[Training] 
Stage complete: train_loss=84.867996, val_loss=86.468491

Total training time: 284.82s
Timing data saved to: /p/project1/cameo/schmidt36/chemtrain-deploy/external/chemtrain/clean_code_base/scaling_results/run_20260202_150203/timing_4dev_13191135_4dev.json

============================================================
SCALING TEST COMPLETE
============================================================
  Total time: 322.969539715s
  Throughput: 20.89 samples/s
  Done with 4 devices

============================================================
Scaling test complete for devices 1-4
Results saved to: /p/project1/cameo/schmidt36/chemtrain-deploy/external/chemtrain/clean_code_base/scaling_results/run_20260202_150203/timing_job_13191135.csv
============================================================
